<Ui>
    <Button name="ButtonTemplate_MenuItem" virtual="true">
        <NormalText font="Fonts/Vera.ttf" fontHeight="8" setAllPoints="false">
            <Anchors>
                <Anchor point="CENTER"/>
            </Anchors>
            <Color r="0.0" g="0.0" b="0.0"/>
        </NormalText>
        <HighlightTexture file="Interface/Editor/MenuBar/MenuBarButtonHighlight.png"/>
        <Scripts>
            <OnClick>
                if (UIParent.activeDropDown) then
                    UIParent.activeDropDown:Hide();
                    if (UIParent.activeDropDown ~= this.DropDown) then
                        this.DropDown:Show();
                        UIParent.activeDropDown = this.DropDown;
                    else
                        UIParent.activeDropDown = nil;
                    end
                else
                    this.DropDown:Show();
                    UIParent.activeDropDown = this.DropDown;
                end
            </OnClick>
        </Scripts>
    </Button>
    
    <Button name="ButtonTemplate_SubMenuItem" virtual="true">
        <NormalText font="Fonts/Vera.ttf" fontHeight="8" justifyH="LEFT" setAllPoints="false">
            <Anchors>
                <Anchor point="TOPLEFT">
                    <Offset>
                        <AbsDimension x="16"/>
                    </Offset>
                </Anchor>
                <Anchor point="BOTTOMRIGHT"/>
            </Anchors>
            <Color r="0.0" g="0.0" b="0.0"/>
        </NormalText>
        <HighlightTexture file="Interface/Editor/MenuBar/MenuBarButtonHighlight.png"/>
    </Button>
    
    <Frame name="FrameTemplate_DropDown" virtual="true" hidden="true">    
        <Size>
            <AbsDimension x="116" y="16"/>
        </Size>
        <Backdrop bgFile="Interface/Editor/MenuBar/MenuBarBackground.png"/>
        <Scripts>
            <OnLoad>
                this.updated = false;
            </OnLoad>
            <OnShow>
                if (not this.updated) then
                    local children = { this:GetChildren() };
                    local maxWidth = 0;
                    local totalHeight = 0;
                    
                    for k, child in pairs(children) do
                        maxWidth = math.max(child:GetWidth(), maxWidth);
                        totalHeight = totalHeight + child:GetHeight();
                    end
                  
                    if (maxWidth > 100) then
                        for k, child in pairs(children) do
                            child:SetWidth(maxWidth);
                        end
                        
                        this:SetWidth(maxWidth);
                    end
                    
                    this:SetHeight(math.max(totalHeight, 16));
                    
                    this.updated = true;
                end
            </OnShow>
        </Scripts>
    </Frame>

	<Frame name="MenuBar" parent="UIParent" clampedToScreen="true">
		<Size>
			<AbsDimension y="16"/>
		</Size>
		<Anchors>
			<Anchor point="TOPLEFT"/>
            <Anchor point="TOPRIGHT"/>
		</Anchors>
        <Backdrop bgFile="Interface/Editor/MenuBar/MenuBarBackground.png"/>
        <Scripts>
            <OnLoad>
                this.activeDropDown = nil;
            </OnLoad>
        </Scripts>
        <Frames>
            <Button name="$parentFileButton" inherits="ButtonTemplate_MenuItem">
                <Size>
                    <AbsDimension y="16"/>
                </Size>
                <Anchors>
                    <Anchor point="TOPLEFT"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        this:SetText(MenuBar.Locale.File);
                        this:SetWidth(math.max(this:GetTextWidth()+6, 16));
                    </OnLoad>
                </Scripts>
                <Frames>
                    <Frame name="$parentDropDown" inherits="FrameTemplate_DropDown">
                        <Anchors>
                            <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT"/>
                        </Anchors>
                        <Frames>
                            <Button name="$parentNew" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.FileNew);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Ctrl-N">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                            <Button name="$parentOpen" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentNew" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.FileOpen);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Ctrl-O">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                            <Button name="$parentSave" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentOpen" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.FileSave);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Ctrl-S">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                            <Button name="$parentSaveAs" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentSave" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.FileSaveAs);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                            </Button>
                            <Button name="$parentQuit" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentSaveAs" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.FileQuit);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                    <OnClick>
                                        Exit();
                                    </OnClick>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Esc.">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                        </Frames>
                    </Frame>
                </Frames>
            </Button>
            <Button name="$parentEditButton" inherits="ButtonTemplate_MenuItem">
                <Size>
                    <AbsDimension y="16"/>
                </Size>
                <Anchors>
                    <Anchor point="TOPLEFT" relativeTo="$parentFileButton" relativePoint="TOPRIGHT"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        this:SetText(MenuBar.Locale.Edit);
                        this:SetWidth(math.max(this:GetTextWidth()+6, 16));
                    </OnLoad>
                </Scripts>
                <Frames>
                    <Frame name="$parentDropDown"  inherits="FrameTemplate_DropDown">
                        <Anchors>
                            <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT"/>
                        </Anchors>
                        <Frames>
                            <Button name="$parentUndo" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.EditUndo);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Ctrl-Z">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                            <Button name="$parentRedo" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentUndo" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.EditRedo);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Ctrl-Shift-Z">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                            <Button name="$parentCopy" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentRedo" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.EditCopy);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Ctrl-C">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                            <Button name="$parentPaste" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentCopy" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.EditPaste);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="Ctrl-V">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                        </Frames>
                    </Frame>
                </Frames>
            </Button>
            <Button name="$parentViewButton" inherits="ButtonTemplate_MenuItem">
                <Size>
                    <AbsDimension y="16"/>
                </Size>
                <Anchors>
                    <Anchor point="TOPLEFT" relativeTo="$parentEditButton" relativePoint="TOPRIGHT"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        this:SetText(MenuBar.Locale.View);
                        this:SetWidth(math.max(this:GetTextWidth()+6, 16));
                    </OnLoad>
                </Scripts>
                <Frames>
                    <Frame name="$parentDropDown"  inherits="FrameTemplate_DropDown">
                        <Anchors>
                            <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT"/>
                        </Anchors>
                        <Frames>
                        </Frames>
                    </Frame>
                </Frames>
            </Button>
            <Button name="$parentSettingsButton" inherits="ButtonTemplate_MenuItem">
                <Size>
                    <AbsDimension y="16"/>
                </Size>
                <Anchors>
                    <Anchor point="TOPLEFT" relativeTo="$parentViewButton" relativePoint="TOPRIGHT"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        this:SetText(MenuBar.Locale.Settings);
                        this:SetWidth(math.max(this:GetTextWidth()+6, 16));
                    </OnLoad>
                </Scripts>
                <Frames>
                    <Frame name="$parentDropDown"  inherits="FrameTemplate_DropDown">
                        <Anchors>
                            <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT"/>
                        </Anchors>
                        <Frames>
                        </Frames>
                    </Frame>
                </Frames>
            </Button>
            <Button name="$parentHelpButton" inherits="ButtonTemplate_MenuItem">
                <Size>
                    <AbsDimension y="16"/>
                </Size>
                <Anchors>
                    <Anchor point="TOPLEFT" relativeTo="$parentSettingsButton" relativePoint="TOPRIGHT"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        this:SetText(MenuBar.Locale.Help);
                        this:SetWidth(math.max(this:GetTextWidth()+6, 16));
                    </OnLoad>
                </Scripts>
                <Frames>
                    <Frame name="$parentDropDown"  inherits="FrameTemplate_DropDown">
                        <Anchors>
                            <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT"/>
                        </Anchors>
                        <Frames>
                            <Button name="$parentShowHelp" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.HelpShowHelp);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                                <Layers>
                                    <Layer>
                                        <FontString name="$parentKey" font="Fonts/Vera.ttf" fontHeight="8" justifyH="RIGHT" text="F1">
                                            <Anchors>
                                                <Anchor point="RIGHT">
                                                    <Offset>
                                                        <AbsDimension x="-16"/>
                                                    </Offset>
                                                </Anchor>
                                            </Anchors>
                                            <Color r="0.5" g="0.5" b="0.5"/>
                                        </FontString>
                                    </Layer>
                                </Layers>
                            </Button>
                            <Button name="$parentAbout" inherits="ButtonTemplate_SubMenuItem">
                                <Size>
                                    <AbsDimension y="16"/>
                                </Size>
                                <Anchors>
                                    <Anchor point="TOPLEFT" relativeTo="$parentShowHelp" relativePoint="BOTTOMLEFT"/>
                                </Anchors>
                                <Scripts>
                                    <OnLoad>
                                        this:SetText(MenuBar.Locale.HelpAbout);
                                        local width = math.max(this:GetTextWidth(), 100);
                                        if (this.Key) then
                                            width = width + 6 + this.Key:GetStringWidth();
                                        end
                                        this:SetWidth(width);
                                    </OnLoad>
                                </Scripts>
                            </Button>
                        </Frames>
                    </Frame>
                </Frames>
            </Button>
            <Button name="$parentCloseButton"  inherits="ButtonTemplate_MenuItem" text="X">
                <Size>
                    <AbsDimension x="16" y="16"/>
                </Size>
                <Anchors>
                    <Anchor point="TOPRIGHT"/>
                </Anchors>
                <Scripts>
                    <OnClick>
                        Exit();
                    </OnClick>
                </Scripts>
            </Button>
        </Frames>
	</Frame>
</Ui>
